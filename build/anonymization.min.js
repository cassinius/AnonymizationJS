!function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){(function(t){var i=r(1),n=r(3),a=r(4),o="undefined"!=typeof window?window:t;o.Anonymity={GenHierarchy:{String:i.StringGenHierarchy,Category:i.ContGenHierarchy},Input:{CSV:n.CSV},Algorithms:{Sangreea:a.SaNGreeA}},e.exports={$G:o.$G}}).call(t,function(){return this}())},function(e,t,r){"use strict";var i=r(2),n=function(){function e(e){this.filePath=e,this._entries={},this._nr_levels=0;var t=JSON.parse(i.readFileSync(e).toString());this._name=t.name,this.readFromJson(t)}return e.prototype.readFromJson=function(e){var t=0;for(var r in e.entries){var i=e.entries[r],n=+i.level;0===n&&t++,n>this._nr_levels&&(this._nr_levels=n);var a={name:i.name,gen:i.gen,level:i.level};this._entries[r]=a}if(1!==t)throw new Error("JSON invalid. Level 0 must contain exactly 1 entry.")},e.prototype.nrLevels=function(){return this._nr_levels},e.prototype.getEntries=function(){return this._entries},e.prototype.getLevelEntry=function(e){return this._entries[e]?this._entries[e].level:void 0},e.prototype.getGeneralizationOf=function(e){return this._entries[e]?this._entries[e].gen:void 0},e.prototype.getName=function(e){return this._entries[e].name},e}();t.StringGenHierarchy=n;var a=function(){function e(e,t,r){if(this._name=e,this._min=t,this._max=r,t>r)throw new Error("Range invalid. Min greater than Max.");if(t===r)throw new Error("Range invalid. Min equals Max.")}return e.prototype.genCostOfRange=function(e,t){if(e>t)throw new Error("Cannot generalize to negative range.");if(e<this._min)throw new Error("Cannot generalize span. From parameter less than range min.");if(t>this._max)throw new Error("Cannot generalize span. To parameter greater than range max.");return(t-e)/(this._max-this._min)},e}();t.ContGenHierarchy=a},function(e,t){},function(e,t){"use strict";var r=function(){function e(e){void 0===e&&(e=","),this._sep=e}return e.prototype.readCSV=function(){},e}();t.CSV=r},function(e,t,r){"use strict";var i=r(2),n=r(1),a=r(5),o=r(!function(){var e=new Error('Cannot find module "graphinius"');throw e.code="MODULE_NOT_FOUND",e}());!function(e){e[e.CONTINUOUS=0]="CONTINUOUS",e[e.CATEGORICAL=1]="CATEGORICAL"}(t.HierarchyType||(t.HierarchyType={}));var s=(t.HierarchyType,function(){function e(e,t){if(void 0===e&&(e="default"),this._name=e,this.config=t,this._cont_hierarchies={},this._cat_hierarchies={},this._range_hierarchy_indices={},this._categorical_hierarchy_indices={},this._config=t||a.CONFIG,""===this._config.INPUT_FILE)throw new Error("Input file cannot be an empty string");if(this._config.NR_DRAWS<0)throw new Error("Options invalid. Nr_draws can not be negative.");if(this._config.EDGE_MIN<0)throw new Error("Options invalid. Edge_min can not be negative.");if(this._config.EDGE_MAX<0)throw new Error("Options invalid. Edge_max can not be negative.");if(this._config.EDGE_MAX<this._config.EDGE_MIN)throw new Error("Options invalid. Edge_min cannot exceed edge_max.");this._graph=new o.core.BaseGraph(this._name),this._perturber=new o.perturbation.SimplePerturber(this._graph),this._SEP=new RegExp(this._config.SEPARATOR,this._config.SEP_MOD),this._TRIM=new RegExp(this._config.TRIM,this._config.TRIM_MOD)}return e.prototype.getConfig=function(){return this._config},e.prototype.getContHierarchies=function(){return this._cont_hierarchies},e.prototype.getCatHierarchies=function(){return this._cat_hierarchies},e.prototype.getContHierarchy=function(e){return this._cont_hierarchies[e]},e.prototype.getCatHierarchy=function(e){return this._cat_hierarchies[e]},e.prototype.setContHierarchy=function(e,t){this._cont_hierarchies[e]=t},e.prototype.setCatHierarchy=function(e,t){this._cat_hierarchies[e]=t},e.prototype.instantiateGraph=function(e){void 0===e&&(e=!0),this.instantiateRangeHierarchies(this._config.INPUT_FILE),this.readCSV(this._config.INPUT_FILE,this._graph),e===!0&&this._perturber.createRandomEdgesSpan(this._config.EDGE_MIN,this._config.EDGE_MAX,!1)},e.prototype.instantiateCategoricalHierarchies=function(){},e.prototype.instantiateRangeHierarchies=function(e){var t=this,r=(Object.keys(this._cont_hierarchies),Object.keys(this._config.GEN_WEIGHT_VECTORS[this._config.VECTOR].range));if(!(r.length<1)){var a=i.readFileSync(e).toString().split("\n"),o=a.shift().trim().replace(this._TRIM,"").split(this._SEP);o.forEach(function(e,i){r.indexOf(e)!==-1&&(t._range_hierarchy_indices[e]=i)});var s={};r.forEach(function(e){s[e]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}});var c=NaN;a.forEach(function(e,i){var n=e.trim().replace(t._TRIM,"").split(t._SEP);r.forEach(function(e){c=parseFloat(n[t._range_hierarchy_indices[e]]),c<s[e].min&&(s[e].min=c),c>s[e].max&&(s[e].max=c)})}),r.forEach(function(e){var r=new n.ContGenHierarchy(e,s[e].min,s[e].max);t.setContHierarchy(r._name,r)})}},e.prototype.readCSV=function(e,t){this.instantiateRangeHierarchies(e);var r=i.readFileSync(e).toString().split("\n"),n=r.shift().trim().replace(this._TRIM,"").split(this._SEP),a=Object.keys(this._cont_hierarchies),o=Object.keys(this._cat_hierarchies),s={};n.forEach(function(e,t){a.indexOf(e)!==-1&&(s[t]=e)});var c={};n.forEach(function(e,t){o.indexOf(e)!==-1&&(c[t]=e)});var h=n.indexOf(this._config.TARGET_COLUMN);if(h<0)throw new Error("Target column does not exist... aborting.");for(var _=this._config.NR_DRAWS,f=0;f<_;f++)if(r[f]){var g=r[f].trim().replace(this._TRIM,"").split(this._SEP),u=!0;for(var l in c){var p=this.getCatHierarchy(c[l]);p&&!p.getLevelEntry(g[l])&&(u=!1)}for(var l in s){this.getContHierarchy(s[l]);+g[l]!==+g[l]&&(u=!1)}if(u){var E=this._graph.addNodeByID(""+f);for(var l in c)E.setFeature(c[l],g[l]);for(var l in s)E.setFeature(s[l],+g[l]);E.setFeature(this._config.TARGET_COLUMN,g[h])}else _++}},e.prototype.outputPreprocCSV=function(e,t){var r="",n=this._graph.getNodes(),a=null,o=0;Object.keys(this._cont_hierarchies).forEach(function(e){r+=e+", "}),Object.keys(this._cat_hierarchies).forEach(function(e){r+=e+", "}),r+=this._config.TARGET_COLUMN+"\n";for(var s in this._graph.getNodes()){a=n[s],t=t||{};var c=parseFloat(t.prob),h=t.feat,_=t.value;if(null!=c&&null!=h&&null!=_)if(parseFloat(_)!==parseFloat(_)){if(Math.random()<c&&a.getFeature(h)===_){o++;continue}}else if(Math.random()<c&&a.getFeature(h)>_){o++;continue}Object.keys(this._cont_hierarchies).forEach(function(e){r+=a.getFeature(e)+", "}),Object.keys(this._cat_hierarchies).forEach(function(e){r+=a.getFeature(e)+", "}),r+=a.getFeature(this._config.TARGET_COLUMN)+"\n"}console.log("Eliminated "+o+" rows from a DS of "+this._graph.nrNodes()+" rows."),i.writeFileSync("./test/io/test_output/"+e+".csv",r)},e.prototype.outputAnonymizedCSV=function(e){var t=this,r="";Object.keys(this._cont_hierarchies).forEach(function(e){r+=e+", "}),Object.keys(this._cat_hierarchies).forEach(function(e){r+=e+", "}),r+=this._config.TARGET_COLUMN+"\n";for(var n in this._clusters){var a=this._clusters[n],o=a.nodes;for(var s in o)Object.keys(this._cont_hierarchies).forEach(function(e){var i=a.gen_ranges[e];if(i[0]===i[1])r+=i[0]+", ";else if(t._config.AVERAGE_OUTPUT_RANGES){var n=(i[0]+i[1])/2;r+=n+", "}else r+="["+i[0]+" - "+i[1]+"], "}),Object.keys(this._cat_hierarchies).forEach(function(e){var i=t._cat_hierarchies[e];r+=i.getName(a.gen_feat[e])+", "}),r+=o[s].getFeature(this._config.TARGET_COLUMN)+"\n"}i.writeFileSync("./test/io/test_output/"+e+".csv",r)},e.prototype.anonymizeGraph=function(){var e,t,r,i,n,a,o,s,c,h,_,f=this,g=[],u=this._graph.getNodes(),l=Object.keys(u),p={},E=Object.keys(u).length;for(h=0;h<l.length;h++)if(e=u[l[h]],!p[e.getID()]){var v={nodes:{},gen_feat:{},gen_ranges:{}};for(Object.keys(this._cat_hierarchies).forEach(function(t){v.gen_feat[t]=e.getFeature(t)}),Object.keys(this._cont_hierarchies).forEach(function(t){v.gen_ranges[t]=[e.getFeature(t),e.getFeature(t)]}),v.nodes[e.getID()]=e,p[e.getID()]=!0,E--;Object.keys(v.nodes).length<this._config.K_FACTOR&&E;){for(c=Number.POSITIVE_INFINITY,_=h+1;_<l.length;_++)t=u[l[_]],p[t.getID()]||(n=this.calculateCatCosts(v,t),i=this.calculateContCosts(v,t),a=n+i,o=this._config.BETA>0?this.calculateSIL(v,t):0,s=this._config.ALPHA*a+this._config.BETA*o,s<c&&(c=s,r=t));v.nodes[r.getID()]=r,this.updateLevels(v,r),Object.keys(this._cont_hierarchies).forEach(function(e){f.updateRange(v.gen_ranges[e],r.getFeature(e))}),p[r.getID()]=!0,E--}g.push(v)}console.log("Built "+g.length+" clusters."),this._clusters=g},e.prototype.calculateSIL=function(e,t){var r=this._graph.nrNodes()-2,i=[],n=t.reachNodes().map(function(e){return e.node.getID()});for(var a in e.nodes){var o=r,s=e.nodes[a].reachNodes().map(function(e){return e.node.getID()});for(var c in s){var h=s[c];h!==t.getID()&&n.indexOf(h)!==-1&&--o}i.push(o/r)}return i.reduce(function(e,t){return e+t},0)/i.length},e.prototype.updateLevels=function(e,t){for(var r in this._cat_hierarchies){for(var i=this.getCatHierarchy(r),n=e.gen_feat[r],a=t.getFeature(r),o=i.getLevelEntry(n),s=i.getLevelEntry(a);n!==a;)a=i.getGeneralizationOf(a),s=i.getLevelEntry(a),o>s&&(n=i.getGeneralizationOf(n),o=i.getLevelEntry(n));e.gen_feat[r]=n}},e.prototype.calculateCatCosts=function(e,t){var r=0;for(var i in this._cat_hierarchies){for(var n=this.getCatHierarchy(i),a=e.gen_feat[i],o=t.getFeature(i),s=n.getLevelEntry(a),c=n.getLevelEntry(o);a!==o;)o=n.getGeneralizationOf(o),c=n.getLevelEntry(o),s>c&&(a=n.getGeneralizationOf(a),s=n.getLevelEntry(a));var h=this._config.GEN_WEIGHT_VECTORS[this._config.VECTOR].categorical;r+=h[i]*((n.nrLevels()-s)/n.nrLevels())}var _=Object.keys(this._cat_hierarchies).length;return _>1?r/_:r},e.prototype.calculateContCosts=function(e,t){var r=this,i=0,a=this._config.GEN_WEIGHT_VECTORS[this._config.VECTOR].range;Object.keys(this._cont_hierarchies).forEach(function(o){var s=r.getContHierarchy(o),c=e.gen_ranges[o],h=r.expandRange(c,t.getFeature(o)),_=s instanceof n.ContGenHierarchy?s.genCostOfRange(h[0],h[1]):0;i+=a[o]+_});var o=Object.keys(this._cont_hierarchies).length;return o>1?i/o:i},e.prototype.expandRange=function(e,t){var r=t<e[0]?t:e[0],i=t>e[1]?t:e[1];return[r,i]},e.prototype.updateRange=function(e,t){e[0]<e[0]?t:e[0],e[1]=t>e[1]?t:e[1]},e}());t.SaNGreeA=s},function(e,t){"use strict";var r={INPUT_FILE:"./test/io/test_input/adult_data.csv",TRIM:"\\s+",TRIM_MOD:"g",SEPARATOR:",",SEP_MOD:"",TARGET_COLUMN:"marital-status",AVERAGE_OUTPUT_RANGES:!0,NR_DRAWS:300,RANDOM_DRAWS:!1,EDGE_MIN:3,EDGE_MAX:10,K_FACTOR:19,ALPHA:1,BETA:0,GEN_WEIGHT_VECTORS:{equal:{categorical:{workclass:1/13,"native-country":1/13,sex:1/13,race:1/13,relationship:1/13,occupation:1/13,income:1/13},range:{age:1/13,fnlwgt:1/13,"education-num":1/13,"capital-gain":1/13,"capital-loss":1/13,"hours-per-week":1/13}},emph_race:{categorical:{workclass:.01,"native-country":.01,sex:.01,race:.88,relationship:.01,occupation:.01,income:.01},range:{age:.01,fnlwgt:.01,"education-num":.01,"capital-gain":.01,"capital-loss":.01,"hours-per-week":.01}},emph_age:{categorical:{workclass:.01,"native-country":.01,sex:.01,race:.01,relationship:.01,occupation:.01,income:.01},range:{age:.88,fnlwgt:.01,"education-num":.01,"capital-gain":.01,"capital-loss":.01,"hours-per-week":.01}}},VECTOR:"equal"};t.CONFIG=r}]);